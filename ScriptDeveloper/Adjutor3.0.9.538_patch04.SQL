UPDATE  VERSAOSISTEMA 
SET VERSAOSISTEMA.SCRIPTADJUTOR = '3.0.9.538 patch 4',
       VERSAOSISTEMA.DATA   = '13.11.2019',
	    VERSAO = '3.0.9.538'
 where VERSAOSISTEMA.CODIGO = 1;


commit work;

ALTER TABLE ISS0000 ALTER COLUMN ISS_MUNICIPIO TYPE VARCHAR(50);
ALTER TABLE ISS0000 ADD CID_CODIGO INTEGER;
ALTER TABLE ISS0000 ADD ISS_PERCENT_INSS NUMERIC(18,5) DEFAULT 0;
ALTER TABLE ISS0000 ADD ISS_PERCENT_CSLL NUMERIC(18,5) DEFAULT 0;
ALTER TABLE ISS0000 ADD ISS_PERCENT_IR NUMERIC(18,5) DEFAULT 0;
ALTER TABLE ISS0000 ADD ISS_PERCENT_PIS NUMERIC(18,5) DEFAULT 0;
ALTER TABLE ISS0000 ADD ISS_PERCENT_COFINS NUMERIC(18,5) DEFAULT 0;
ALTER TABLE ISS0000 DROP ISS_PERC_RET;
ALTER TABLE EMP0000 DROP EMP_PERCENT_INSS;
ALTER TABLE EMP0000 DROP EMP_PERCENT_CSLL ;
ALTER TABLE EMP0000 DROP EMP_PERCENT_ISS ;
ALTER TABLE EMP0000 DROP EMP_PERCENT_IR ;
ALTER TABLE EMP0000 DROP EMP_PERCENT_PIS ;
ALTER TABLE EMP0000 DROP EMP_PERCENT_COFINS ;

INSERT INTO ISS0000 (ISS_CODIGO, ISS_MUNICIPIO, CID_CODIGO, ISS_UF )
SELECT CID_CODIGO, CID_CIDADE, CID_CODIGO, CID_ESTADO FROM CID0000;

COMMIT WORK;

COMMENT ON COLUMN ISS0000.CID_CODIGO IS 'CODIGO DA TABELA CID0000';
COMMENT ON COLUMN ISS0000.ISS_PERCENT_INSS IS 'PERCENTUAL INSS';
COMMENT ON COLUMN ISS0000.ISS_PERCENT_CSLL IS 'PERCENTUAL CSLL';
COMMENT ON COLUMN ISS0000.ISS_PERCENT_IR IS 'PERCENTUAL IR';
COMMENT ON COLUMN ISS0000.ISS_PERCENT_PIS IS 'PERCENTUAL PIS';
COMMENT ON COLUMN ISS0000.ISS_PERCENT_COFINS IS 'PERCENTUAL COFINS';
COMMENT ON COLUMN ISS0000.ISS_PGRC_ISS IS 'PERCENTUAL ISS';


COMMENT ON COLUMN FAT0000.FAT_VL_RET IS  'VALOR DA RETENCAO';
ALTER TABLE FAT0000 ADD FAT_CID_CODIGO_PRESTACAO INTEGER;

ALTER TABLE NFSE_IT ADD NFSI_RETENCOESFEDERAIS NUMERIC(18,5);
COMMENT ON COLUMN NFSE_IT.NFSI_RETENCOESFEDERAIS IS 'retencoes federais';

COMMENT ON COLUMN FAT0000.FAT_IRPJ_PERC is 'PERCENTUAL RETENCAO IR' ;
COMMENT ON COLUMN FAT0000.FAT_IRPJ_RET is 'RETENCAO IR' ;
COMMENT ON COLUMN FAT0000.FAT_PIS_PERC IS 'PERCENTUAL RETENCAO PIS' ;
COMMENT ON COLUMN FAT0000.FAT_PIS_RET	is 'RETENCAO PIS' ;
COMMENT ON COLUMN FAT0000.FAT_COFINS_PERC is 'PERCENTUAL RETENCAO COFINS' ;
COMMENT ON COLUMN FAT0000.FAT_COFINS_RET IS 'RETENCAO COFINS' ;
COMMENT ON COLUMN FAT0000.FAT_CONTSOCIAL_PERC IS 'PERCENTUAL RETENCAO CSLL' ;
COMMENT ON COLUMN FAT0000.FAT_CONTSOCIAL_RET IS 'RETENCAO CSLL' ;
COMMENT ON COLUMN FAT0000.FAT_INSS_PERC IS 'PERCENTUAL RETENCAO INSS' ;
COMMENT ON COLUMN FAT0000.FAT_INSS_RET is 'RETENCAO INSS' ;
COMMENT ON COLUMN FAT0000.FAT_ISS_PERC is 'PERCENTUAL RETENCAO ISS' ;
COMMENT ON COLUMN FAT0000.FAT_ISS_RET is 'RETENCAO ISS' ;
COMMENT ON COLUMN FAT0000.FAT_VL_RET IS 'VALOR TOTAL RETIDO';
COMMENT ON COLUMN FAT0000.FAT_BASE_ISS IS 'BASE DE ISS';
COMMENT ON COLUMN FAT0000.FAT_BASE_INSS IS 'BASE DE INSS';

COMMENT ON COLUMN FAT0000.FAT_CID_CODIGO_PRESTACAO IS 'LOCAL DE PRESTACAO ';



UPDATE CNAE
SET CNAE_ATIVO = 'I';

COMMIT WORK;

UPDATE CNAE
SET CNAE_ATIVO = 'A'
WHERE CNAE_CODIGO IN (SELECT DISTINCT CNAE_Codigo FROM NFSERVICO
						WHERE CNAE_Codigo IS NOT NULL OR (TRIM(CNAE_Codigo) <> ''));
COMMIT WORK;


ALTER TABLE OPE0000 ADD OPE_TEMRETENCAO VARCHAR(1);
COMMENT ON COLUMN OPE0000.OPE_TEMRETENCAO IS 'SERVICO TEM RETENCAO';

UPDATE OPE0000
SET OPE_TEMRETENCAO = 'N';

COMMIT WORK;


CREATE INDEX NFSERVICO_DTEMISSAO ON NFSERVICO (NFSE_DATAEMISSAO);
CREATE INDEX NFSERVICO_LOTE ON NFSERVICO (NUM_LOTE);
