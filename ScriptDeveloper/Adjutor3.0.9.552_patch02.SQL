UPDATE  VERSAOSISTEMA 
SET VERSAOSISTEMA.SCRIPTADJUTOR = '3.0.9.552  patch 2',
    VERSAOSISTEMA.DATA   = '26.01.2021',
	VERSAO = '3.0.9.552'
 where VERSAOSISTEMA.CODIGO = 1;
 
commit work;

ALTER TABLE BAN0000 ALTER COLUMN BAN_CODAGEDIG TYPE VARCHAR(2);

ALTER TABLE GANCHO  ADD GAN_QTD_ESPIRAS FLOAT NOT NULL; 

CREATE OR ALTER VIEW VW_CONSULTA_NOTA_FISCAL_ENTRADA (NFE_XML, ENF_REGISTRO, ENF_NOTANUMBER, OPE_NATUREZA, ENF_EMISSAO,ENF_ENTRADA, OCP_CODIGO, FOR_CODIGO, ENF_TOT_PROD, ENF_VLFRETE, ENF_VLSEGURO, ENF_DESP_ACES, ENF_TOT_NOTA, ENF_TIPO_NF_ENTRADA, RAZAO_SOCIAL, EMP_CODIGO, ENF_FECHADO_PROJETO_OBRA, ENF_BASE_IPI, ENF_VALOR_IPI, ENF_BASE_ICMS, ENF_VALOR_ICMS, ENF_BASE_ICMS_ST, ENF_VALOR_ICMS_ST)
AS
SELECT
case when (e1.ENF_XML is null) THEN 
        'N'
     else
        'S'
end,
E1.enf_registro,
E1.ENF_NOTANUMBER,
E1.OPE_NATUREZA,
E1.ENF_EMISSAO,
E1.ENF_ENTRADA,
(SELECT FIRST 1 T55.OCP_CODIGO FROM ENF_IT01 T55 WHERE (T55.ENF_IT_NOTANUMBER = E1.ENF_NOTANUMBER AND T55.FOR_CODIGO = E1.FOR_CODIGO AND T55.OCP_CODIGO <> '000000')),
E1.FOR_CODIGO,
E1.ENF_TOT_PROD,
E1.ENF_VLFRETE,
E1.ENF_VLSEGURO,
E1.ENF_DESP_ACES,
E1.ENF_TOT_NOTA,
E1.ENF_TIPO_NF_ENTRADA,
CASE WHEN E1.ENF_TIPO_NF_ENTRADA = 'N' THEN
  (SELECT F1.FOR_RAZAO FROM FOR0000 F1 WHERE (F1.FOR_CODIGO = E1.FOR_CODIGO))
ELSE
  (SELECT T1.TRP_RAZAO FROM TRP0000 T1 WHERE (T1.TRP_CODIGO = E1.FOR_CODIGO))
END AS RAZAO_SOCIAL,
E1.EMP_CODIGO,
E1.enf_fechado_projeto_obra,
e1.enf_base_ipi,
e1.enf_vl_ipi,
e1.enf_baseicms,
e1.enf_vl_icms,
e1.enf_vlbasesubtrib,
e1.enf_vl_subtrib


FROM ENF0001 E1;